**核心思想**

TCC 其实就是采用的补偿机制，其核心思想是：针对每个操作，都要注册一个与其对应 的确认和补偿

（撤销）操作。它分为三个阶段：



Try阶段：尝试执行,完成所有业务检查（一致性）,预留必须业务资源（准隔离性）



Confirm阶段：确认执行真正执行业务，不作任何业务检查，只使用Try阶段预留的业务资源，

Confirm操作满足幂等性。要求具备幂等设计，Confirm失败后需要进行重试。



Cancel阶段：取消执行，释放Try阶段预留的业务资源，Cancel操作满足幂等性并且Cancel阶段的异

常和Confirm阶段异常处理方案基本上一致。



<img src="..\..\resource\TCC补偿.png" style="zoom:77%;" />





**优缺点**

优点： 相比两阶段提交，可用性比较强，毕竟有补偿措施，而不是阻塞在那里

缺点： 数据的一致性要差一些。TCC属于应用层的一种补偿方式，所以需要程序员在实现的时候多写很

多补偿的代码，在一些场景中，一些业务流程可能用TCC不太好定义及处理。



使用TCC时要注意Try - Confirm - Cancel 3个操作的**幂等控制**，网络原因，或者重试操作都有可能导致

这几个操作的重复执行



update account set available_money = available_money-1000 where user_id=#{userId} 