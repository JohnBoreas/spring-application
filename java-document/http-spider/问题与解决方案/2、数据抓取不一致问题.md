线上抓取到的数据与数据库数据不一致


原因是：缓存导致抓到的数据被过滤了，但是数据库里是错误的

数据库数据与缓存不一致，缓存数据与抓取的最新数据一致，导致无法更新数据




**根本原因：**

主从库延迟导致

主库写入速度比从库同步速度要快，容易导致唯一键索引插入问题

缓存更新成功了但是数据库因为唯一键更新失败

缓存过滤掉最新数据导致不一致



**问题剖析：**

程序入库地方只有一个线程，不存在多个线程同时入库同一条数据的情况

同一组数据入库，根据唯一键会过滤掉相同的数据，不存在同一批次更新唯一键索引问题

缓存更新与数据入库都是按顺序入库的

有唯一键错误，说明了读到的数据与实际库里的不一致





**解决方案：**

1、将redis key修改为另一个key

2、然后重新跑数据

带来的问题是会在一定时间内对db压力增大，影响其他业务

