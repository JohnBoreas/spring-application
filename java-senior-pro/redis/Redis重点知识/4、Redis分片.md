一、分片概念

1、**Redis的分片机制允许数据拆分存放在不同的Redis实例上，每个Redis实例只包含所有键的子集。**

2、作用：**可以减轻单台Redis的压力，提升Redis扩展能力和计算能力**。



二、分片方案

如何将不同key上传到不同的Redis实例上？

1、范围分片

如：一个算法将用户userid从0到1000映射到实例A，userid从1000到2000映射到实例B，以此类推。

**方案可以使用，但是效率比其他分片方案低效许多，所有Redis中一般不会使用范围分片作为分片方案。**



2、哈希分片

存储一个key。我们可以通过[哈希函数](https://so.csdn.net/so/search?q=哈希函数&spm=1001.2101.3001.7020)crc32()将key名转换成一个长整型数字，然后对长整型数字对4取余，就可以得到映射的实例。

**缺点：需要增加或移除Redis实例时，就会造成大量key无法被命中。**



3、一致性哈希分片

**Redis中没有使用一致性哈希这个概念，而是引入了哈希槽。**



三、分片实现

一般有三种 : **客户端分片**、**代理分片**和**服务器分片**。

客户端分片：客户端自己计算key需要映射到哪一个Redis实例。



四、分片缺点

1、分片是由多台Redis实例共同运转，所以如果其中一个Redis实例宕机，则整个分片都将无法使用，所以分片机制无法实现高可用。

2、如果有不同的key映射到不同的Redis实例，这时候不能对这两个key做交集或者使用事务。

3、使用分片机制因为涉及多实例，数据处理比较复杂。

4、分片中对于实例的添加或删除会很复杂，不过可以使用预分片技术进行改善。