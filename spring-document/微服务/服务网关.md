网关就像是微服务的大门守卫一样，是连通外部客户端与内部微服务之间的一个桥梁。

其主要功能有：

**路由转发**

对外唯一入口，所全部的请求先发到网关上，然后由网关来根据不同的请求去路由到不同的微服务节点上。

**负载均衡**

根据内部微服务每个实例的负荷情况进行动态的负载均衡调节

**安全认证**

进行身份验证，身份验证通过后才转发给后面的服务，转发的时候一般也会带上身份信息。

**日志记录**

可以在网关上统一集中的记录下这些行为日志。这些日志既可以作为我们后续事件查询使用，也可以作为系统的性能监控使用。

**数据转换**

将不同客户端传输进来的数据转换成同一种类型再转发给内部微服务上



组件

Kong、Zuul、Spring Cloud Gateway



##### Kong

Kong是基于OpenResty技术栈的开源网关服务，因此其也是基于Nginx实现的。

Kong可以做到高性能、插件自定义、集群以及易于使用的Restful API管理。



##### Zuul

Zuul是Netflix在2013年开源的网关组件

可以与Eureka、Ribbon、Hystrix等组件配合使用，实现路由转发、负载均衡、熔断等功能

Zuul基于Servlet构建，使用的是阻塞的IO，引入了线程池来处理请求

过滤器filter是整个Zuul的核心，分为前置过滤器（pre filter）、路由过滤器（routing filter）、后置过滤器（post filter）以及 错误过滤器（error filter）



**Spring Cloud Gateway**

Spring Cloud的一个全新的API网关项目，目的是为了替换掉Zuul1。

实现路由转发、负载均衡、熔断，限流（内置）等功能

**特性**

```
1、基于Spring 5，Reactor(模式) 和 SpringBoot 2.0
2、能够在任何请求属性上匹配路由
3、断言和过滤器是特定于路由的
4、Hystrix断路器集成
5、SpringCloud DiscoveryClient集成
6、易于编写断言和过滤器
7、请求速率限制
8、路径重写
```

**Route(**路由)：

 路由是网关的基本组件。它由ID、目标URI、谓词集合和过滤器集合定义。如果集合断言为真，则匹配路由

**Predicate(**断言) ： 

这是java 8的一个函数式接口predicate,可以用于lambda表达式和方法引用，输入类型是：

Spring Framework ServerWebExchange,允许开发人员匹配来自HTTP请求的任何内容，例如

请求头headers和参数paramers

**Filter(**过滤器) ： 

是GatewayFilter的一个实例，在这里，可以在发送下游请求之前或之后修改请求和响

应，这些是使用特定工厂构建的Spring Framework GatewayFilter 实例，这里可以在发送下游请求之

前或之后修改请求和响应





Zuul1和Gateway对比

| 对比项          | Zuul1.x                                                      | Gateway                                                      |
| --------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 实现            | 基于Servlet2.x构建，使用阻塞的API。                          | 基于Spring5、ProjectReactor、Spring Boot2，使用非阻塞式的API。 |
| 长连接          | 不支持                                                       | 支持                                                         |
| 不适用场景      | 后端服务响应慢或者高并发场景下，因为线程数量是固定（有限）的，线程容易被耗尽，导致新请求被拒绝。 | 中小流量的项目，使用Zuul1.x更合适。                          |
| 限流            | 无                                                           | 内置限流过滤器                                               |
| 上手难度        | 同步编程，上手简单                                           | 门槛较高，上手难度中等                                       |
| SpringCloud集成 | 是                                                           | 是                                                           |
| Sentinel集成    | 是                                                           | 是                                                           |
| 技术栈沉淀      | Zuul1开源近七年，经受考验，稳定成熟。                        | 未见实际落地案例                                             |
| Github used by  | 1007 repositories                                            | 102 repositories                                             |
| Github issues   | 88 Open / 2736 Closed                                        | 135 Open / 850 Closed                                        |