#### MVCC 简介

叫做多版本并发控制，实际上就是保存了数据在某个时间节点的快照。

每行数实际上隐藏了两列，创建时间版本号，过期(删除)时间版本号。

每开始一个新的事务，版本号都会自动递增。

MVCC 的原理是查找创建版本小于或等于当前事务版本，删除版本为空或者大于当前事务版本



#### 解决问题

- 在并发读写数据库时，可以做到在读操作时不用阻塞写操作，写操作也不用阻塞读操作，提高了数据库并发读写的性能
- 同时还可以解决脏读，幻读，不可重复读等事务隔离问题，但不能解决更新丢失问题



#### MVCC的实现原理

目的就是多版本并发控制，在数据库中的实现，就是为了解决`读写冲突`，

它的实现原理主要是依赖记录中的 `3个隐式字段`，`undo日志` ，`Read View` 来实现的。

（1）隐式字段

```sql
DB_TRX_ID`,`DB_ROLL_PTR`,`DB_ROW_ID

DB_TRX_ID	6byte，最近修改(修改/插入)事务ID：记录创建这条记录/最后一次修改该记录的事务ID
DB_ROLL_PTR	7byte，回滚指针，指向这条记录的上一个版本（存储于rollback segment里）
DB_ROW_ID	6byte，隐含的自增ID（隐藏主键），如果数据表没有主键，InnoDB会自动以DB_ROW_ID产生一个聚簇索引
实际还有一个删除flag隐藏字段, 既记录被更新或删除并不代表真的删除，而是删除flag变了
```

![在这里插入图片描述](..\resource\mvcc字段.png)

#### 快照读和MVCC的关系

MVCC是一个概念， “维持一个数据的多个版本，使得读写操作没有冲突” 

快照读是实现MVCC理想模型的其中一个具体非阻塞读功能





